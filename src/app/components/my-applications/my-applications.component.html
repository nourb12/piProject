<app-header></app-header>

<div class="applications-container">
  <h2 class="title">ðŸ“Œ My Applications</h2>

  <!-- Search bar -->
  <mat-form-field appearance="outline" class="search-bar">
    <mat-label>Search Applications</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Search by title, company, or location">
  </mat-form-field>

  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner></mat-spinner>
  </div>

  <!-- Applications Table -->
  <table mat-table [dataSource]="filteredApplications" class="mat-elevation-z8 custom-table" *ngIf="!loading">

    <!-- TITLE -->
    <ng-container matColumnDef="title">
      <th mat-header-cell *matHeaderCellDef> Title </th>
      <td mat-cell *matCellDef="let app"> {{ app.internshipOffer?.title }} </td>
    </ng-container>

    <!-- COMPANY -->
    <ng-container matColumnDef="company">
      <th mat-header-cell *matHeaderCellDef> Company </th>
      <td mat-cell *matCellDef="let app"> {{ app.internshipOffer?.companyName }} </td>
    </ng-container>

    <!-- LOCATION -->
    <ng-container matColumnDef="location">
      <th mat-header-cell *matHeaderCellDef> Location </th>
      <td mat-cell *matCellDef="let app"> {{ app.internshipOffer?.location }} </td>
    </ng-container>

    <!-- DURATION -->
    <ng-container matColumnDef="duration">
      <th mat-header-cell *matHeaderCellDef> Duration </th>
      <td mat-cell *matCellDef="let app"> {{ app.internshipOffer?.duration }} months </td>
    </ng-container>

    <!-- STAGE TYPE -->
    <ng-container matColumnDef="stageType">
      <th mat-header-cell *matHeaderCellDef> Type </th>
      <td mat-cell *matCellDef="let app"> {{ app.internshipOffer?.stageType }} </td>
    </ng-container>

    <!-- OFFER STATUS -->
    <ng-container matColumnDef="offerStatus">
      <th mat-header-cell *matHeaderCellDef> Offer Status </th>
      <td mat-cell *matCellDef="let app">
        <span class="status-badge" [ngClass]="getStatusClass(app.internshipOffer?.offerStatus)">
          {{ app.internshipOffer?.offerStatus }}
        </span>
      </td>
    </ng-container>

    <!-- APPLICATION STATUS -->
    <ng-container matColumnDef="applicationStatus">
      <th mat-header-cell *matHeaderCellDef> Application Status </th>
      <td mat-cell *matCellDef="let app">
        <span class="status-badge" [ngClass]="getApplicationStatusClass(app.status)">
          {{ app.status }}
        </span>
      </td>
    </ng-container>

    <!-- SUBMISSION DATE -->
    <ng-container matColumnDef="submissionDate">
      <th mat-header-cell *matHeaderCellDef> Submitted On </th>
      <td mat-cell *matCellDef="let app"> {{ app.submissionDate | date:'yyyy-MM-dd HH:mm' }} </td>
    </ng-container>

    <!-- IMAGE -->
    <ng-container matColumnDef="image">
      <th mat-header-cell *matHeaderCellDef> Image </th>
      <td mat-cell *matCellDef="let app">
        <img *ngIf="app.internshipOffer?.imageUrls?.length > 0" 
             [src]="app.internshipOffer.imageUrls[0]" 
             alt="Internship Image"
             class="internship-image"
             (click)="openImageModal(app.internshipOffer.imageUrls[0])">
      </td>
    </ng-container>

    <!-- CV -->
    <ng-container matColumnDef="cvPdfUrl">
      <th mat-header-cell *matHeaderCellDef> CV </th>
      <td mat-cell *matCellDef="let app">
        <a *ngIf="app.cvPdfUrl"
           [href]="'http://localhost:8909' + app.cvPdfUrl"
           target="_blank"
           class="btn btn-outline-primary btn-sm">
          <i class="bi bi-file-earmark-pdf"></i> CV
        </a>
        <span *ngIf="!app.cvPdfUrl" class="text-muted">N/A</span>
      </td>
    </ng-container>

    <!-- MOTIVATION LETTER -->
    <ng-container matColumnDef="motivationPdfUrl">
      <th mat-header-cell *matHeaderCellDef> Cover Letter </th>
      <td mat-cell *matCellDef="let app">
        <a *ngIf="app.motivationPdfUrl"
           [href]="'http://localhost:8909' + app.motivationPdfUrl"
           target="_blank"
           class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-envelope-paper"></i> Letter
        </a>
        <span *ngIf="!app.motivationPdfUrl" class="text-muted">N/A</span>
      </td>
    </ng-container>

    <!-- Header & Row -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>

<app-footer></app-footer>
