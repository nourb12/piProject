<div class="card p-4 shadow">
  <h3 class="text-center mb-4" style="color:#dc3545;">
    <i class="bi bi-bar-chart-fill"></i> Applications Dashboard
  </h3>

  <!-- Section NEWS & Notifications -->
  <div class="card p-4 shadow">
    <h3 class="text-center mb-4" style="color:#dc3545;">NEWS</h3>

    <div *ngIf="notifications.length > 0" class="mb-4">
      <h4>Notifications</h4>
      <div class="table-responsive">
        <table class="table table-bordered table-striped">
          <thead class="table-dark">
            <tr>
              <th>Message</th>
              <th>Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let notification of notifications">
              <td>
                <i *ngIf="!notification.read" class="bi bi-circle-fill text-danger"></i>
                <i *ngIf="notification.read" class="bi bi-circle-fill text-muted"></i>
                {{ notification.message }}
              </td>
              <td>{{ notification.timestamp | date:'short' }}</td>
              <td>
                <span *ngIf="!notification.read" class="badge bg-danger">Unread</span>
                <span *ngIf="notification.read" class="badge bg-success">Read</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div *ngIf="notifications.length === 0" class="alert alert-secondary">
      <strong>No new notifications!</strong>
    </div>
  </div>

  <!-- Filtres -->
  <div class="mb-4">
    <div class="row g-3">
      <div class="col-md-4">
        <input type="text" class="form-control" placeholder="üîç Search by full name or email..."
               [(ngModel)]="searchTerm" (ngModelChange)="filterApplications()">
      </div>
      <div class="col-md-4">
        <select class="form-select" [(ngModel)]="offerIdFilter" (change)="filterApplications()">
          <option value="">All Offers</option>
          <option *ngFor="let offer of internshipOffers" [value]="offer.id">
            {{ offer.title }}
          </option>
        </select>
      </div>
      <div class="col-md-4">
        <select class="form-select" [(ngModel)]="sortField" (change)="filterApplications()">
          <option value="">Sort By...</option>
          <option value="fullName">Full Name</option>
          <option value="email">Email</option>
          <option value="submissionDate">Submission Date</option>
        </select>
      </div>
    </div>
  </div>

  <!-- ‚úÖ TABLEAU AVEC PHOTO ET SANS ACTIONS -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Photo</th>
          <th>Full Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>City</th>
          <th>Submission Date</th>
          <th>Offer ID</th>
          <th>Status</th>
          <th>üìÑ CV</th>
          <th>üíå Letter</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let application of filteredApplications; let i = index">
          <td>{{ i + 1 }}</td>
          <td>
            <ng-container *ngIf="application.photoUrl">
              <img [src]="'http://localhost:8909/files/' + application.photoUrl.split('/').pop()"
                   class="rounded-circle" width="40" height="40" />
            </ng-container>
          </td>
          <td>{{ application.fullName }}</td>
          <td>{{ application.email }}</td>
          <td>{{ application.phone }}</td>
          <td>{{ application.city }}</td>
          <td>{{ application.submissionDate | date:'medium' }}</td>
          <td>{{ application.internshipOffer?.id }}</td>
          <td>
            <span *ngIf="application.status === 'ACCEPTED'" class="badge bg-success">‚úÖ Accepted</span>
            <span *ngIf="application.status === 'WAITING'" class="badge bg-warning text-dark">‚è≥ Waiting</span>
            <span *ngIf="application.status === 'DENIED'" class="badge bg-danger">‚ùå Denied</span>
          </td>
          <td>
            <a *ngIf="application.cvPdfUrl" [href]="'http://localhost:8909' + application.cvPdfUrl" target="_blank"
               class="btn btn-outline-primary btn-sm">
              <i class="bi bi-file-earmark-pdf"></i> CV
            </a>
          </td>
          <td>
            <a *ngIf="application.motivationPdfUrl" [href]="'http://localhost:8909' + application.motivationPdfUrl" target="_blank"
               class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-envelope-paper"></i> Letter
            </a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ‚úÖ PIPELINE DYNAMIQUE -->
  <div class="pipeline-container mt-5">
   <!-- ‚è≥ WAITING -->
<div class="status-column"
cdkDropList
id="waitingList"
[cdkDropListConnectedTo]="dropListIds"
(cdkDropListDropped)="onDrop($event, 'WAITING')">
<h5 class="text-center">‚è≥ Waiting</h5>
<div *ngFor="let app of waitingApps" cdkDrag [cdkDragData]="app" class="card text-center p-2 mb-2">
<ng-container *ngIf="app.photoUrl">
 <img [src]="'http://localhost:8909/files/' + app.photoUrl.split('/').pop()" class="rounded-circle mb-2" width="50" height="50">
</ng-container>
<p class="mb-0">{{ app.fullName }}</p>
</div>
</div>

<!-- ‚úÖ ACCEPTED -->
<div class="status-column"
cdkDropList
id="acceptedList"
[cdkDropListConnectedTo]="dropListIds"
(cdkDropListDropped)="onDrop($event, 'ACCEPTED')">
<h5 class="text-center">‚úÖ Accepted</h5>
<div *ngFor="let app of acceptedApps" cdkDrag [cdkDragData]="app" class="card text-center p-2 mb-2">
<ng-container *ngIf="app.photoUrl">
 <img [src]="'http://localhost:8909/files/' + app.photoUrl.split('/').pop()" class="rounded-circle mb-2" width="50" height="50">
</ng-container>
<p class="mb-0">{{ app.fullName }}</p>
</div>
</div>

<!-- ‚ùå DENIED -->
<div class="status-column"
cdkDropList
id="deniedList"
[cdkDropListConnectedTo]="dropListIds"
(cdkDropListDropped)="onDrop($event, 'DENIED')">
<h5 class="text-center">‚ùå Denied</h5>
<div *ngFor="let app of deniedApps" cdkDrag [cdkDragData]="app" class="card text-center p-2 mb-2">
<ng-container *ngIf="app.photoUrl">
 <img [src]="'http://localhost:8909/files/' + app.photoUrl.split('/').pop()" class="rounded-circle mb-2" width="50" height="50">
</ng-container>
<p class="mb-0">{{ app.fullName }}</p>
</div>
</div>

  </div>
</div>
